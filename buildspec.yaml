version: 0.2
phases:
  install:
    runtime-versions:
      nodejs: 14
  build:
    commands:
      - if [ "$CODEBUILD_WEBHOOK_TRIGGER" != "branch/main" ]; then
          echo "Skipping deployment for branch $CODEBUILD_WEBHOOK_TRIGGER";
          exit 0;
        fi
      - for func in LambdaDev lambdaSF; do
          if [ "${CODEBUILD_SOURCE_VERSION#*$func}" != "$CODEBUILD_SOURCE_VERSION" ]; then
            cd $func;
            npm install;
            zip -r $func.zip *;
            aws s3 cp $func.zip s3://multi-lambda/$func.zip;
            aws lambda update-function-code --function-name $func --s3-bucket multi-lambda --s3-key $func.zip;
          fi
        done



